<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Tiny Notes</title>
    <style>
      body { font-family: sans-serif; max-width: 700px; margin: 40px auto; }
      textarea { width: 100%; height: 80px; }
      button { margin-top: 10px; }
      li { margin: 8px 0; }
      .muted { opacity: 0.7; font-size: 12px; }
    </style>
  </head>
  <body>
    <h1>Tiny Notes</h1>

    <textarea id="content" placeholder="Write a note..."></textarea>
    <br />
    <button id="save">Save</button>

    <h2>Saved notes</h2>
    <ul id="list"></ul>

    <script>
      async function loadNotes() {
        const res = await fetch("/api/notes");
        const data = await res.json();
        const ul = document.getElementById("list");
        ul.innerHTML = "";
        data.notes.forEach(n => {
          const li = document.createElement("li");
          li.innerHTML = `${escapeHtml(n.content)}<div class="muted">${new Date(n.created_at).toLocaleString()}</div>`;
          ul.appendChild(li);
        });
      }

      async function saveNote() {
        const content = document.getElementById("content").value.trim();
        if (!content) return;

        const res = await fetch("/api/notes", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ content })
        });

        if (!res.ok) {
          alert("Save failed");
          return;
        }

        document.getElementById("content").value = "";
        await loadNotes();
      }

      function escapeHtml(str) {
        return str.replace(/[&<>"']/g, m => ({
          "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
        }[m]));
      }

      document.getElementById("save").addEventListener("click", saveNote);
      loadNotes();
    </script>
  </body>
</html>

